# backend/test_api.py
import requests

# –¢–µ—Å—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç (—Å–∏–º—É–ª—è—Ü–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞)
test_contract = """
–î–û–ì–û–í–û–† ‚Ññ 123 –æ—Ç 15 —è–Ω–≤–∞—Ä—è 2025 –≥.

–≥. –ú–æ—Å–∫–≤–∞

–û–û–û "–†–æ–º–∞—à–∫–∞", –∏–º–µ–Ω—É–µ–º–æ–µ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", –≤ –ª–∏—Ü–µ –≥–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ò–≤–∞–Ω–æ–≤–∞ –ò.–ò., –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –£—Å—Ç–∞–≤–∞, —Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –∏
–û–û–û "–í–µ–∫—Ç–æ—Ä", –∏–º–µ–Ω—É–µ–º–æ–µ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º "–ó–∞–∫–∞–∑—á–∏–∫", –≤ –ª–∏—Ü–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ü–µ—Ç—Ä–æ–≤–∞ –ü.–ü., –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –£—Å—Ç–∞–≤–∞, —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –∑–∞–∫–ª—é—á–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π –¥–æ–≥–æ–≤–æ—Ä –æ –Ω–∏–∂–µ—Å–ª–µ–¥—É—é—â–µ–º:

1. –ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê
1.1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è –æ–∫–∞–∑–∞—Ç—å —É—Å–ª—É–≥–∏ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è, –∞ –ó–∞–∫–∞–∑—á–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∏—Ç—å —ç—Ç–∏ —É—Å–ª—É–≥–∏.
1.2. –°—Ä–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è: –¥–æ 31 –¥–µ–∫–∞–±—Ä—è 2025 –≥–æ–¥–∞.

2. –°–¢–û–ò–ú–û–°–¢–¨ –ò –ü–û–†–Ø–î–û–ö –û–ü–õ–ê–¢–´
2.1. –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 500 000 (–ø—è—Ç—å—Å–æ—Ç —Ç—ã—Å—è—á) —Ä—É–±–ª–µ–π.
2.2. –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –∞–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç.

3. –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨ –°–¢–û–†–û–ù
3.1. –ó–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤ –æ–ø–ª–∞—Ç—ã –ó–∞–∫–∞–∑—á–∏–∫ —É–ø–ª–∞—á–∏–≤–∞–µ—Ç –ø–µ–Ω—é –≤ —Ä–∞–∑–º–µ—Ä–µ 0.1% –æ—Ç —Å—É–º–º—ã –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏.
3.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –∫–∞—á–µ—Å—Ç–≤–æ –æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥.

4. –§–û–†–°-–ú–ê–ñ–û–†
4.1. –°—Ç–æ—Ä–æ–Ω—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –Ω–µ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤ –Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º–æ–π —Å–∏–ª—ã.

5. –°–†–û–ö –î–ï–ô–°–¢–í–ò–Ø –î–û–ì–û–í–û–†–ê
5.1. –î–æ–≥–æ–≤–æ—Ä –≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ 31.12.2025.

–ü–û–î–ü–ò–°–ò –°–¢–û–†–û–ù:

–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:                    –ó–∞–∫–∞–∑—á–∏–∫:
________ /–ò–≤–∞–Ω–æ–≤ –ò.–ò./          ________ /–ü–µ—Ç—Ä–æ–≤ –ü.–ü./
"""

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ API
print("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞ –Ω–∞ –∞–Ω–∞–ª–∏–∑...")

response = requests.post(
    "http://127.0.0.1:8000/api/analyze",
    files={"file": ("test_contract.txt", test_contract.encode('utf-8'))}
)

print(f"\nüìä –°—Ç–∞—Ç—É—Å: {response.status_code}")

if response.status_code == 200:
    result = response.json()
    print("\n‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω!")
    print(f"\nüìÑ –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞: {result['result']['extracted_data']['document_type']}")
    print(f"üë• –°—Ç–æ—Ä–æ–Ω—ã: {', '.join(result['result']['extracted_data']['parties'])}")
    print(f"üí∞ –°—É–º–º–∞: {result['result']['extracted_data']['total_amount']} {result['result']['extracted_data']['currency']}")
    print(f"üìÖ –î–∞—Ç—ã: {result['result']['extracted_data']['dates']}")
    print(f"\n‚ö†Ô∏è –†–∏—Å–∫–∏ ({len(result['result']['risk_flags'])}):")
    for flag in result['result']['risk_flags']:
        print(f"  ‚Ä¢ [{flag['level'].upper()}] {flag['category']}: {flag['description']}")
    print(f"\n‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–µ–π—Å—Ç–≤–∏–π:")
    for item in result['result']['action_items']:
        print(f"  ‚Ä¢ {item}")
    print(f"\nüìù –†–µ–∑—é–º–µ: {result['result']['summary']}")
else:
    print(f"\n‚ùå –û—à–∏–±–∫–∞: {response.text}")